<%#= render 'shared/user_icon', css_class:"bi d-block mx-auto mb-4 rounded-circle" %>

<%= avatar(css_class: "bi d-block mx-auto mb-4", width: 40, height: 40) || gravatar(css_class: "bi d-block mx-auto mb-4", width: 40, height: 40) %>

<%= form_with model: @user, url: setting_me_path do |user_form| %>

  <%= user_form.fields_for :person do |person_form| %>

	  <%= tag.div class: "d-flex flex-wrap" do %>
		
			<%= tag.div class: "flex-fill me-2 mb-3" do %>	
					
       <%= render 'form_field', form: person_form, 
			                         field: {sym: :first_name, str: "First name*", type: :text_field},
											      required: true, 
													 autofocus: user_form.object.errors.empty?  %>

			<% end %>

			<%= tag.div class: "flex-fill me-2 mb-3" do %>

        <%= render 'form_field', form: person_form, 
 			                          field: {sym: :middle_name, str: "Middle name", type: :text_field}, 
 											       required: false, 
 													  autofocus: false  %>

			<% end %>

		<% end %>


	  <%= tag.div class: "d-flex flex-wrap" do %>
		
			<%= tag.div class: "flex-fill me-2 mb-3" do %>
			
        <%= render 'form_field', form: person_form, 
 			                          field: {sym: :last_name, str: "Last name*", type: :text_field},
 											       required: true,
 													  autofocus: false  %>

			<% end %>
			
	  <% end %>
			
		<%= tag.div class: "d-flex flex-wrap" do %>	
			
			<%= tag.div class: "flex-fill pe-2 mb-3" do %>
			
        <%= render 'form_field', form: person_form, 
 			                          field: {sym: :birthday, str: "Birthday", type: :date_field},
 											       required: false,
 													  autofocus: false  %>

		  <% end %>
			
	    <%= tag.div class: "flex-fill mb-3" do %>

			  <%= person_form.label :gender, class: "form-label" %>
		  
			  <% if @user.gender? %>
				  <%= tag.div do %>
					  <strong><%= @user.gender %></strong>
					<% end %>
				<% else %>
				  <%= tag.div class: "flex-fill me-2 mb-3" do %>
				    <%= person_form.select :gender, Person.genders.values, class: "form-control" %>
					<% end %> 
				<% end %>
				
			<% end %>
			
		<% end %>


   <%= tag.div class: "d-flex flex-wrap mt-5" do %>

			<%= tag.div class: "flex-fill me-2 mb-3" do %>
				
			  <%= user_form.label :username, "Username", class: "form-label" %>
				
			  <%= tag.div do %>
				  <strong><%= @user.username %></strong>
				<% end %>

			<% end %>

	 <% end %>


   <%= tag.div class: "d-flex flex-wrap mt-5" do %> 	

		  <%= tag.div class: "flex-fill me-2 mb-3" do %>
			  
				<%= tag.label class: "form-label" do %>
				  EMAIL <%= pluralize(@user.email_addresses.count, "address").split(/\s/).last.upcase %>
				<% end %>
				<%= tag.hr %>
	      
				<% @stored_email_addresses = @user.email_addresses.select {|e| e.persisted? } %>
				<%#= render @user.email_addresses %> 
				<%= render @stored_email_addresses %>
				
			<% end %>	

		<% end %>
		
		<% if @stored_email_addresses.many? %>
				
		    <%= tag.div class: "d-flex flex-wrap" do %>

		 		  <%= tag.div class: "flex-fill me-2 mb-3" do %>
					
					  <%= person_form.label :primary_email_address_id, "Primary Email Address", class: "form-label" %>
												
						<% if person_form.object.errors.messages[:primary_email_address_id].any? %>
						  <%= tag.div class: "alert alert-danger" do %>
							  <%= render 'shared/errors/error_message', error_message: person_form.object.errors.messages[:primary_email_address_id].first %>
								<%= person_form.select :primary_email_address_id, @user.email_addresses.map {|e| [e.address, e.id]}, class: "form-control" %>
							<% end %>
						<% else %>
						  <%= person_form.select :primary_email_address_id, @stored_email_addresses.map {|e| [e.address, e.id]}, class: "form-control" %>
						<% end %>
				
		 			<% end %>	

		 		<% end %>
		
		<% end %>
		
		<%= tag.div class: "d-flex flex-wrap" do %>
		
			<%= person_form.fields_for :email_addresses do |email_form| %>
			
			  <% unless email_form.object.persisted? %>
			
					<%= tag.div class: "flex-fill me-2 mb-3" do %>
				
			      <%= render 'form_field', form: email_form, 
					                          field: {sym: :address, str: "Add an email address", type: :email_field},
													       required: false,
															  autofocus: false  %>

					<% end %>
					
				<% end %>
				
			<% end %>
		
		<% end %>	
			
  <% end %> <!-- end of: user_form.fields_for :person ... -->
	
		  
	<%= tag.div class: "d-flex flex-wrap mt-5 mb-3" do %>
	 <strong>CHANGE PASSWORD</strong>
  <% end %>

  <%= tag.div class: "d-flex flex-wrap" do %>
		
		<%= tag.div class: "flex-fill me-2 mb-3" do %>
		
      <%= render 'form_field', form: user_form, 
		                          field: {sym: :password, str: "New Password", type: :password_field},
										       required: false,
												  autofocus: false  %>
			
		<% end %>
		
		<%= tag.div class: "flex-fill me-2 mb-3" do %>
		
      <%= render 'form_field', form: user_form, 
		                          field: {sym: :password_confirmation, str: "Confirmation", type: :password_field},
										       required: false,
												  autofocus: false  %>
			
		<% end %>
		
	<% end %>
			
  <%= tag.div class: "actions center py-3" do %>
		<%= user_form.submit "Update settings", class: "btn btn-primary w-100"  %>
	<% end %>	

			
<% end %>
