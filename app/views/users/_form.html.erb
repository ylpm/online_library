<%= render 'shared/user_icon', css_class:"bi d-block mx-auto mb-4 rounded-circle" %>

<%#= render 'shared/errors/error_count_message', models: [@user] %>

<%= form_with model: @user, url: (@user.persisted? ? settings_user_path(@user.username) : signup_path) do |user_form| %>

  <%= user_form.fields_for :person do |person_form| %>

	  <%= tag.div class: "d-flex flex-wrap" do %>
		
			<%= tag.div class: "flex-fill me-2 mb-3" do %>	
					
				<%= person_form.label :first_name, "First name*", class: "form-label" %>
						
			  <% if @user.person.errors.messages[:first_name].any? %>
				  <%= tag.div class: "alert alert-danger" do %>
					  <%= render 'shared/errors/error_message', error_message: @user.person.errors.messages[:first_name].first %>
						<%= person_form.text_field :first_name, class: "form-control", required: true, autofocus: true %>
					<% end %>
				<% else %>
				  <%= person_form.text_field :first_name, class: "form-control", required: true, autofocus: true %>
				<% end %>
				
			<% end %>
			
			<% if @user.persisted? %>
			
				<%= tag.div class: "flex-fill me-2 mb-3" do %>
			
					<%= person_form.label :middle_name, class: "form-label" %>
			
				  <% if @user.person.errors.messages[:middle_name].any? %>
					  <%= tag.div class: "alert alert-danger" do %>
						  <%= render 'shared/errors/error_message', error_message: @user.person.errors.messages[:middle_name].first %>
							<%= person_form.text_field :middle_name, class: "form-control" %>
						<% end %>
					<% else %>
					  <%= person_form.text_field :middle_name, class: "form-control" %>
					<% end %>
				
				<% end %>
				
			<% end %>
			
		<% end %>


	  <%= tag.div class: "d-flex flex-wrap" do %>
		
			<%= tag.div class: "flex-fill me-2 mb-3" do %>	
			
				<%= person_form.label :last_name, "Last name*", class: "form-label" %>
			
			  <% if @user.person.errors.messages[:last_name].any? %>
				  <%= tag.div class: "alert alert-danger" do %>
					  <%= render 'shared/errors/error_message', error_message: @user.person.errors.messages[:last_name].first %>
						<%= person_form.text_field :last_name, class: "form-control", required: true%>
					<% end %>
				<% else %>
				  <%= person_form.text_field :last_name, class: "form-control", required: true %>
				<% end %>
				
			<% end %>
			
			<% if @user.persisted? %>
			
				<%= tag.div class: "flex-fill me-2 mb-3" do %>	
			
					<%= person_form.label :birthday, class: "form-label" %>
			
				  <% if @user.person.errors.messages[:birthday].any? %>
					  <%= tag.div class: "alert alert-danger" do %>
						  <%= render 'shared/errors/error_message', error_message: @user.person.errors.messages[:birthday].first %>
							<%= person_form.date_field :birthday, class: "form-control" %>
						<% end %>
					<% else %>
					  <%= person_form.date_field :birthday, class: "form-control" %>
					<% end %>
			
			  <% end %>
				
		  <% end %>
			
		<% end %>
	
	
	  <%= tag.div class: "d-flex flex-wrap" do %>
		  
			<% if @user.persisted? %>
			
		    <%= tag.div class: "flex-fill me-2 mb-3" do %>
			  
				  <%= person_form.label :gender, class: "form-label" %>
			  
				  <% if @user.gender? %>
					  <%= tag.div do %>
						  <strong><%= @user.gender %></strong>
						<% end %>
					<% else %>
					  <%= tag.div class: "flex-fill me-2 mb-3" do %>
					    <%= person_form.select :gender, Person.genders.values, class: "form-control" %>
						<% end %> 
					<% end %>
					
				<% end %>
				
			<% end %>
		
			<%= tag.div class: "flex-fill me-2 mb-3" do %>
	
				<% if @user.persisted? %>
				
				  <%= user_form.label :username, "Username", class: "form-label" %>
					
				  <%= tag.div do %>
					  <strong><%= @user.username %></strong>
					<% end %>

				<% else %>

				  <%= user_form.label :username, "Username*", class: "form-label" %>

			 	  <% if @user.errors.messages[:username].any? %>
			 		  <%= tag.div class: "alert alert-danger" do %>
			 			  <%= render 'shared/errors/error_message', error_message: @user.errors.messages[:username].first %>
			 				<%= user_form.text_field :username, class: "form-control", required: true %>
			 			<% end %>
			 		<% else %>
			 		  <%= user_form.text_field :username, class: "form-control", required: true %>
			 		<% end %>

				<% end %>
	
			<% end %>

			<% if @user.persisted? %>
			
			  <%= tag.div class: "flex-fill me-2 mb-3" do %>
				  
					<%= tag.label class: "form-label" do %>
					  Email <%= pluralize(@user.email_addresses.count, "address").split(/\s/).last.capitalize %>
					<% end %>
					<br>
		
				  <% @user.email_addresses.each do |email_address| %>
							<strong><%= email_address.address %></strong>
							<% if !email_address.activated? %>
							  <%= link_to "Activate", "#", class: "form-links text-small" %>
							<% end %>
							<br/>
				  <% end %>
					
				<% end %>

			<% else %>

				<%= person_form.fields_for :email_addresses do |email_form| %>
					<%= tag.div class: "flex-fill me-2 mb-3" do %>
					  <%= email_form.label :email_address, class: "form-label" do %>
						  Email address*
						<% end %>

					  <% if email_form.object.errors.messages[:address].any? %>
						  <%= tag.div class: "alert alert-danger" do %>
							  <%= render 'shared/errors/error_message', error_message: email_form.object.errors.messages[:address].first %>
								<%= email_form.email_field :address, class: "form-control", required: true %>
							<% end %>
						<% else %>
						  <%= email_form.email_field :address, class: "form-control", required: true %>
						<% end %>				
					<% end %>
				<% end %>

		  <% end %>	

		<% end %>
			
  <% end %> <!-- end of: user_form.fields_for :person ... -->
	
	
  <% if @user.persisted? %>
	  
		<%= tag.div class: "d-flex flex-wrap mt-5 mb-3" do %>
		 <strong>CHANGE PASSWORD</strong>
	  <% end %>
	<% #else %>
	
	<% end %>
	

  <%= tag.div class: "d-flex flex-wrap" do %>
		
		<%= tag.div class: "flex-fill me-2 mb-3" do %>
		
			<%= user_form.label :password, class: "form-label" do %>
			  <%= @user.persisted? ? "New Password" : "Password*" %>
			<% end %>	
			
		  <% if @user.errors.messages[:password].any? %>
			  <%= tag.div class: "alert alert-danger" do %>
				  <%= render 'shared/errors/error_message', error_message: @user.errors.messages[:password].first %>
					<%= user_form.password_field :password, class: "form-control", required: (!@user.persisted?) %>
				<% end %>
			<% else %>
			  <%= user_form.password_field :password, class: "form-control", required: (!@user.persisted?) %>
			<% end %>
			
		<% end %>
		
		<%= tag.div class: "flex-fill me-2 mb-3" do %>
		
			<%= user_form.label :password_confirmation, class: "form-label" do %>
			  Password confirmation<%= "*" unless @user.persisted? %>
			<% end %>
		
		  <% if @user.errors.messages[:password_confirmation].any? %>
			  <%= tag.div class: "alert alert-danger" do %>
				  <%= render 'shared/errors/error_message', error_message: @user.errors.messages[:password_confirmation].first %>
					<%= user_form.password_field :password_confirmation, class: "form-control", required: (!@user.persisted?) %>
				<% end %>
			<% else %>
			  <%= user_form.password_field :password_confirmation, class: "form-control", required: (!@user.persisted?) %>
			<% end %>
			
		<% end %>
		
	<% end %>
			
  <%= tag.div class: "actions center py-3" do %>
		<%= user_form.submit @user.persisted? ? "Update settings" : "Sign up", class: "btn btn-primary w-100"  %>
	<% end %>	

			
<% end %>
